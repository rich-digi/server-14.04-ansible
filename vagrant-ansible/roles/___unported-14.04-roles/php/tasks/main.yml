---
# tasks file for php

- name: Install php
  apt: pkg={{ item }} state=latest
  with_items:
    - php5
    - php5-cli
    - php5-curl
    - php5-dev
    - php5-gd
    - php5-mcrypt
    - php5-mysql

- name: ensure PHP PEAR is installed
  action: apt pkg=php-pear state=installed
  tags: drush

- name: Update PEAR
  action: command pear upgrade-all
  tags: drush

- name: Update PECL
  command: pecl channel-update pecl.php.net

- name: Install YAML support - pipe return to interactive promt using yes
  shell: yes '' | pecl install yaml

- name: install composer
  shell: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin creates=/usr/local/bin/composer
  tags: composer
  notify: restart ufw

- name: rename composer.phar to composer
  shell: mv /usr/local/bin/composer.phar /usr/local/bin/composer creates=/usr/local/bin/composer
  tags: composer

- name: make composer executable
  file: path=/usr/local/bin/composer mode=a+x state=file
  tags: composer
    
- name: Customise apache2/php.ini
  template: src=apache2-php.ini.j2 dest=/etc/php5/apache2/php.ini mode=0644